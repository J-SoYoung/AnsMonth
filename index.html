<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    @import url("/style.css");
  </style>
  <title>AnsMonth</title>

</head>

<body>
  <h2>AnsMonth</h2>
  <form>
    <input id="today" type="date">
    <input id="give" type="number" placeholder="기부">
    <input id="lunch" type="number" placeholder="식대">
    <input id="etc" type="number" placeholder="기타">
    <input id="not_sale" type="number" placeholder="판매불가">
    <input id="trash" type="number" placeholder="폐기">
    <button onclick="info_Enter()">입력</button>
  </form>

  <div id="ans_today_log">
    <h2>일지</h2>
    <table id="table_today_log" class="table table-bordered">
      <thead>
        <tr class="text-center">
          <th scope="col" abbr="">날짜</th>
          <th scope="col" abbr="">기부</th>
          <th scope="col" abbr="">식대</th>
          <th scope="col" abbr="">기타(식대 외 카드사용)</th>
          <th scope="col" abbr="">판매불가</th>
          <th scope="col" abbr="">폐기</th>
          <th scope="col" abbr="">-</th>
        </tr>
      </thead>
      <tbody id="tbody_today_log"></tbody>
    </table>
  </div>
  <div id="ans_month_log">
    <h2>월 합산</h2>
    <table class="table table-bordered">
      <thead>
        <tr class="text-center">
          <th scope="col" abbr="">날짜</th>
          <th scope="col" abbr="">기부</th>
          <th scope="col" abbr="">식대</th>
          <th scope="col" abbr="">기타(식대 외 카드사용)</th>
          <th scope="col" abbr="">판매불가</th>
          <th scope="col" abbr="">폐기</th>
        </tr>
      </thead>
      <tbody id="tbody_month_log"></tbody>
    </table>
  </div>

  <script>
    const $give = document.getElementById('give')
    const $lunch = document.getElementById('lunch')
    const $etc = document.getElementById('etc')
    const $not_sale = document.getElementById('not_sale')
    const $trash = document.getElementById('trash')

    const $tbody_today_log = document.getElementById('tbody_today_log')
    const $tbody_month_log = document.getElementById('tbody_month_log')

    // 데이터 로드
    window.onload = helloAns()
    function helloAns() {
      const storedData = JSON.parse(localStorage.getItem('ansTodayData')) || [];

      storedData.forEach((data) => {
        console.log(data)
        const newRow = document.createElement('tr');
        newRow.innerHTML = `<tr>
          <td>${data.today}</td>
          <td>${parseInt(data.give).toLocaleString()}</td>
          <td>${parseInt(data.lunch).toLocaleString()}</td>
          <td>${parseInt(data.etc).toLocaleString()}</td>
          <td>${parseInt(data.not_sale).toLocaleString()}</td>
          <td>${parseInt(data.trash).toLocaleString()}</td>
          <td><button>수정</button></td>
        </tr>`
        $tbody_today_log.appendChild(newRow);

        // 월 합산 데이터 그리기
        const storedGive = JSON.parse(localStorage.getItem('totalGive')) || [];
        const storedLunch = JSON.parse(localStorage.getItem('totalLunch')) || [];
        const storedEtc = JSON.parse(localStorage.getItem('totalEtc')) || [];
        const storedNotSale = JSON.parse(localStorage.getItem('totalNotSale')) || [];
        const storedTrash = JSON.parse(localStorage.getItem('totalTrash')) || [];

        const currentDate = new Date()
        const curYears = currentDate.getFullYear()
        const curMonth = currentDate.getMonth() + 1

        tbody_month_log.innerHTML = `<tr>
            <td>${curYears}년 ${curMonth}월</td>
            <td>${parseInt(storedGive).toLocaleString()}</td>
            <td>${parseInt(storedLunch).toLocaleString()}</td>
            <td>${parseInt(storedEtc).toLocaleString()}</td>          
            <td>${parseInt(storedNotSale).toLocaleString()}</td>
            <td>${parseInt(storedTrash).toLocaleString()}</td>
          </tr>`
      })


    }

    // 날짜 선택
    const curDate = new Date().toISOString().split('T')[0]
    let $today = document.getElementById('today').value = curDate
    document.getElementById('today').addEventListener('change', handleDateChange)

    function handleDateChange() {
      const curDateChange = document.getElementById('today').value
      $today = curDateChange
    }

    // 데이터 저장 
    function info_Enter() {
      if ($give.value == '' || $lunch.value == '' || $etc.value == '' || $not_sale.value == '' || $trash.value == '') {
        return alert('빈칸있음')
      }
      const data = {
        today: $today,
        give: $give.value,
        lunch: $lunch.value,
        etc: $etc.value,
        not_sale: $not_sale.value,
        trash: $trash.value
      };

      const storedData = JSON.parse(localStorage.getItem('ansTodayData')) || [];
      console.log(storedData)
      storedData.push(data);
      localStorage.setItem('ansTodayData', JSON.stringify(storedData));

      // 각 항목 합산
      const totalGive = storedData.reduce((sum, entry) => sum + parseInt(entry.give), 0);
      const totalLunch = storedData.reduce((sum, entry) => sum + parseInt(entry.lunch), 0);
      const totalEtc = storedData.reduce((sum, entry) => sum + parseInt(entry.etc), 0);
      const totalNotSale = storedData.reduce((sum, entry) => sum + parseInt(entry.not_sale), 0);
      const totalTrash = storedData.reduce((sum, entry) => sum + parseInt(entry.trash), 0);

      localStorage.setItem('totalGive', totalGive);
      localStorage.setItem('totalLunch', totalLunch);
      localStorage.setItem('totalEtc', totalEtc);
      localStorage.setItem('totalNotSale', totalNotSale);
      localStorage.setItem('totalTrash', totalTrash);

      // 새로운 tr생성 
      const newRow = document.createElement('tr');
      newRow.innerHTML = `<tr>
          <td>${$today}</td>
          <td>${parseInt($give.value).toLocaleString()}</td>
          <td>${parseInt($lunch.value).toLocaleString()}</td>
          <td>${parseInt($etc.value).toLocaleString()}</td>
          <td>${parseInt($not_sale.value).toLocaleString()}</td>
          <td>${parseInt($trash.value).toLocaleString()}</td>
          <td><button>수정</button></td>
        </tr>`

      // 일지에 표를 그린다. 
      $tbody_today_log.appendChild(newRow);

      // 월 합산 데이터 그리기
      const storedGive = JSON.parse(localStorage.getItem('totalGive')) || [];
      const storedLunch = JSON.parse(localStorage.getItem('totalLunch')) || [];
      const storedEtc = JSON.parse(localStorage.getItem('totalEtc')) || [];
      const storedNotSale = JSON.parse(localStorage.getItem('totalNotSale')) || [];
      const storedTrash = JSON.parse(localStorage.getItem('totalTrash')) || [];

      const currentDate = new Date()
      const curYears = currentDate.getFullYear()
      const curMonth = currentDate.getMonth() + 1

      tbody_month_log.innerHTML = `<tr>
            <td>${curYears}년 ${curMonth}월</td>
            <td>${parseInt(storedGive).toLocaleString()}</td>
            <td>${parseInt(storedLunch).toLocaleString()}</td>
            <td>${parseInt(storedEtc).toLocaleString()}</td>          
            <td>${parseInt(storedNotSale).toLocaleString()}</td>
            <td>${parseInt(storedTrash).toLocaleString()}</td>
          </tr>`

      $give.value = ''
      $lunch.value = ''
      $etc.value = ''
      $not_sale.value = ''
      $trash.value = ''
    }


  </script>
</body>

</html>